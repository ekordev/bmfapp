{"version":3,"file":"universal-router.js","sources":["../src/matchPath.js","../src/matchRoute.js","../src/resolve.js","../src/main.js"],"sourcesContent":["/**\n * Universal Router (https://www.kriasoft.com/universal-router/)\n *\n * Copyright © 2015-2016 Konstantin Tarkus, Kriasoft LLC. All rights reserved.\n *\n * This source code is licensed under the Apache 2.0 license found in the\n * LICENSE.txt file in the root directory of this source tree.\n */\n\nimport toRegExp from 'path-to-regexp';\n\nconst cache = new Map();\n\nfunction decodeParam(val) {\n  if (!(typeof val === 'string' || val.length === 0)) {\n    return val;\n  }\n\n  try {\n    return decodeURIComponent(val);\n  } catch (err) {\n    if (err instanceof URIError) {\n      err.message = `Failed to decode param '${val}'`;\n      err.status = 400;\n    }\n\n    throw err;\n  }\n}\n\nfunction matchPathBase(end, routePath, urlPath) {\n  const key = `${routePath}|${end}`;\n  let regexp = cache.get(key);\n\n  if (!regexp) {\n    const keys = [];\n    regexp = { pattern: toRegExp(routePath, keys, { end }), keys };\n    cache.set(key, regexp);\n  }\n\n  const m = regexp.pattern.exec(urlPath);\n\n  if (!m) {\n    return null;\n  }\n\n  const params = Object.create(null);\n  const path = m[0];\n\n  for (let i = 1; i < m.length; i++) {\n    params[regexp.keys[i - 1].name] = m[i] !== undefined ? decodeParam(m[i]) : undefined;\n  }\n\n  return { path: path === '' ? '/' : path, keys: regexp.keys.slice(), params };\n}\n\nexport const matchPath = matchPathBase.bind(undefined, true);\nexport const matchBasePath = matchPathBase.bind(undefined, false);\n","/**\n * Universal Router (https://www.kriasoft.com/universal-router/)\n *\n * Copyright © 2015-2016 Konstantin Tarkus, Kriasoft LLC. All rights reserved.\n *\n * This source code is licensed under the Apache 2.0 license found in the\n * LICENSE.txt file in the root directory of this source tree.\n */\n\nimport { matchPath, matchBasePath } from './matchPath';\n\nfunction* matchRoute(route, baseUrl, path) {\n  let match;\n\n  if (!route.children) {\n    match = matchPath(route.path, path);\n\n    if (match) {\n      yield {\n        route,\n        baseUrl,\n        path: match.path,\n        keys: match.keys,\n        params: match.params,\n      };\n    }\n  }\n\n  if (route.children) {\n    match = matchBasePath(route.path, path);\n    if (match) {\n      yield {\n        route,\n        baseUrl,\n        path: match.path,\n        keys: match.keys,\n        params: match.params,\n      };\n\n      for (const childRoute of route.children) {\n        const newPath = path.substr(match.path.length);\n        yield* matchRoute(\n          childRoute,\n          baseUrl + (match.path === '/' ? '' : match.path),\n          newPath.startsWith('/') ? newPath : `/${newPath}`\n        );\n      }\n    }\n  }\n}\n\nexport default matchRoute;\n","/**\n * Universal Router (https://www.kriasoft.com/universal-router/)\n *\n * Copyright © 2015-2016 Konstantin Tarkus, Kriasoft LLC. All rights reserved.\n *\n * This source code is licensed under the Apache 2.0 license found in the\n * LICENSE.txt file in the root directory of this source tree.\n */\n\nimport matchRoute from './matchRoute';\n\nasync function resolve(routes, pathOrContext) {\n  const context = typeof pathOrContext === 'string' || pathOrContext instanceof String\n    ? { path: pathOrContext }\n    : pathOrContext;\n  const root = Array.isArray(routes) ? { path: '/', children: routes } : routes;\n  let result;\n  let value;\n  let done = false;\n\n  const errorRoute = root.children && root.children.find(x => x.path === '/error');\n  const match = matchRoute(root, '', context.path);\n\n  async function next() {\n    ({ value, done } = match.next());\n\n    if (value && !done) {\n      const newContext = Object.assign({}, context, value);\n\n      if (value.route.action) {\n        if (errorRoute) {\n          try {\n            return await value.route.action(newContext, newContext.params);\n          } catch (err) {\n            err.status = err.status || 500;\n            newContext.error = err;\n            return errorRoute.action(newContext, newContext.params);\n          }\n        } else {\n          return await value.route.action(newContext, newContext.params);\n        }\n      }\n    }\n\n    return undefined;\n  }\n\n  context.next = next;\n  context.end = data => { result = data; done = true; };\n\n  while (!done) {\n    result = await next();\n\n    if (result !== undefined) {\n      break;\n    }\n  }\n\n  if (result === undefined && errorRoute) {\n    context.error = new Error('Not found');\n    context.error.status = 404;\n    return errorRoute.action(context, {});\n  }\n\n  return result;\n}\n\nexport default resolve;\n","/**\n * Universal Router (https://www.kriasoft.com/universal-router/)\n *\n * Copyright © 2015-2016 Konstantin Tarkus, Kriasoft LLC. All rights reserved.\n *\n * This source code is licensed under the Apache 2.0 license found in the\n * LICENSE.txt file in the root directory of this source tree.\n */\n\nimport resolve from './resolve';\n\nexport { resolve, resolve as match /* alias */ };\nexport default { resolve, match: resolve /* alias */ };\n"],"names":[],"mappings":"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"}